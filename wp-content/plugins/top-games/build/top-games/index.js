(()=>{"use strict";var e,t={62:(e,t,r)=>{const a=window.wp.blocks,l=JSON.parse('{"UU":"top-games/top-games"}'),n=window.wp.i18n,s=window.wp.blockEditor,i=window.wp.components,o=window.wp.element,d=window.wp.apiFetch;var c=r.n(d);const u=window.ReactJSXRuntime;(0,a.registerBlockType)(l.UU,{edit:function({attributes:e,setAttributes:t}){const{selected:r=[],items:a=1,offset:l,showThumbs:d=!0,variant:m="standard",titleSize:p,headingText:g=""}=e,h=Math.max(1,Math.min(2,a||1)),f=Number.isInteger(l)?l:0,[_,v]=(0,o.useState)("games");(0,o.useEffect)(()=>{let e=!1;return(async()=>{try{const t=await c()({path:"/wp/v2/types/game"});!e&&t?.rest_base&&v(t.rest_base)}catch{}})(),()=>{e=!0}},[]);const[x,b]=(0,o.useState)(""),[y,w]=(0,o.useState)([]),[j,C]=(0,o.useState)(!1),[S,k]=(0,o.useState)(null),[T,$]=(0,o.useState)(""),[O,A]=(0,o.useState)([]),B=(0,o.useRef)(null),R=(0,o.useRef)(null);(0,o.useEffect)(()=>{let e=!1;return(async t=>{R.current&&R.current.abort(),R.current=new AbortController,C(!0),k(null);try{const r=await c()({path:t,signal:R.current.signal}),a=Array.isArray(r)?r.map(e=>({id:e.id,label:e?.title?.rendered||`#${e.id}`})):[];e||w(a)}catch(t){e||"AbortError"===t?.name||k(t?.message||(0,n.__)("Failed to load games.","top-games"))}finally{e||C(!1)}})(`/wp/v2/${_}?per_page=10&_fields=id,title`),()=>{e=!0,R.current&&R.current.abort()}},[_]);const E=async()=>{const e=(x||"").trim();let t=`/wp/v2/${_}?per_page=10&_fields=id,title`;/^\d+$/.test(e)?t=`/wp/v2/${_}?include=${encodeURIComponent(e)}&_fields=id,title`:e.length&&(t=`/wp/v2/${_}?search=${encodeURIComponent(e)}&per_page=10&_fields=id,title`),R.current&&R.current.abort(),R.current=new AbortController,C(!0),k(null);try{const e=await c()({path:t,signal:R.current.signal}),r=Array.isArray(e)?e.map(e=>({id:e.id,label:e?.title?.rendered||`#${e.id}`})):[];w(r)}catch(e){"AbortError"!==e?.name&&k(e?.message||(0,n.__)("Search failed.","top-games"))}finally{C(!1)}};(0,o.useEffect)(()=>{let e=!1;return(async()=>{try{let t;if(r.length){const e=r.slice(0,2).join(",");t=`/wp/v2/${_}?include=${e}&orderby=include&per_page=2&_embed=wp:featuredmedia,wp:term`}else t=`/wp/v2/${_}?per_page=${h}&offset=${f}&orderby=date&order=desc&_embed=wp:featuredmedia,wp:term`;const a=await c()({path:t});e||A(Array.isArray(a)?a:[])}catch{e||A([])}})(),()=>{e=!0}},[r,h,f,_]);const z=e=>(e||"").replace(/<[^>]+>/g,""),D=(e,t)=>t?{sm:"1rem",md:"1.125rem",lg:"1.25rem",xl:"1.5rem","2xl":"2rem","3xl":"2.5rem"}[t]||"1.25rem":"featured"===e?"2.25rem":"1.25rem",I=(0,s.useBlockProps)({className:"top-games "+("featured"===m?"is-variant-featured":"is-variant-standard")});return(0,u.jsxs)("div",{...I,children:[(0,u.jsxs)(s.InspectorControls,{children:[(0,u.jsxs)(i.PanelBody,{title:(0,n.__)("Top Games – Choose up to 2 games","top-games"),initialOpen:!0,children:[(0,u.jsx)(i.TextControl,{label:(0,n.__)("Search games (text or exact ID)","top-games"),value:x,onChange:e=>{b(e),B.current&&clearTimeout(B.current),B.current=setTimeout(E,250)},placeholder:(0,n.__)("e.g. “Zelda” or 123","top-games"),onKeyDown:e=>{"Enter"===e.key&&E()}}),(0,u.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12},children:[(0,u.jsx)(i.Button,{variant:"primary",onClick:E,children:(0,n.__)("Search","top-games")}),(0,u.jsx)(i.Button,{variant:"secondary",onClick:()=>{b(""),E()},children:(0,n.__)("Show recent","top-games")}),(0,u.jsx)(i.Button,{variant:"tertiary",onClick:()=>t({selected:[]}),disabled:!r.length,children:(0,n.__)("Clear selection","top-games")})]}),(0,u.jsxs)("div",{"aria-live":"polite",children:[j&&(0,u.jsx)(i.Spinner,{}),S&&(0,u.jsx)(i.Notice,{status:"error",isDismissible:!1,children:S}),T&&(0,u.jsx)(i.Notice,{status:"info",isDismissible:!1,children:T})]}),!j&&!S&&y.length>0&&(0,u.jsx)("div",{style:{maxHeight:240,overflow:"auto",border:"1px solid #e2e2e2",padding:8,borderRadius:4},children:y.map(e=>(0,u.jsx)(i.CheckboxControl,{label:`${e.label} (ID ${e.id})`,checked:r.includes(e.id),disabled:!r.includes(e.id)&&r.length>=2,onChange:()=>(e=>{if(!r.includes(e))return r.length>=2?($((0,n.__)("You can select up to 2 games.","top-games")),void setTimeout(()=>$(""),1500)):void t({selected:[...r,e]});t({selected:r.filter(t=>t!==e)})})(e.id)},e.id))})]}),(0,u.jsxs)(i.PanelBody,{title:(0,n.__)("Fallback settings","top-games"),initialOpen:!1,children:[(0,u.jsx)(i.RangeControl,{label:(0,n.__)("Number of items when none selected (1–2)","top-games"),value:h,onChange:e=>t({items:Math.max(1,Math.min(2,null!=e?e:1))}),min:1,max:2}),(0,u.jsx)(i.RangeControl,{label:(0,n.__)("Offset when none selected","top-games"),value:Number.isInteger(l)?l:0,onChange:e=>t({offset:Math.max(0,null!=e?e:0)}),min:0,max:50}),(0,u.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,u.jsx)(i.Button,{variant:"secondary",onClick:()=>t({offset:0}),children:(0,n.__)("Set offset to 0","top-games")}),(0,u.jsx)(i.Button,{variant:"tertiary",onClick:()=>t({offset:void 0}),children:(0,n.__)("Unset offset","top-games")})]})]}),(0,u.jsxs)(i.PanelBody,{title:(0,n.__)("Display","top-games"),initialOpen:!1,children:[(0,u.jsx)(i.ToggleControl,{label:(0,n.__)("Show thumbnails","top-games"),checked:!!d,onChange:e=>t({showThumbs:!!e})}),(0,u.jsx)(i.SelectControl,{label:(0,n.__)("Style variant","top-games"),value:m,options:[{label:(0,n.__)("Standard","top-games"),value:"standard"},{label:(0,n.__)("Featured (big headline)","top-games"),value:"featured"}],onChange:e=>t({variant:e})}),(0,u.jsx)(i.SelectControl,{label:(0,n.__)("Title size (optional override)","top-games"),value:p||"",options:[{label:(0,n.__)("Default for variant","top-games"),value:""},{label:"sm",value:"sm"},{label:"md",value:"md"},{label:"lg",value:"lg"},{label:"xl",value:"xl"},{label:"2xl",value:"2xl"},{label:"3xl",value:"3xl"}],onChange:e=>t({titleSize:e||void 0})}),(0,u.jsx)(i.TextControl,{label:(0,n.__)("Heading text above block","top-games"),value:g,onChange:e=>t({headingText:e}),placeholder:(0,n.__)("e.g. Top Stories","top-games")})]})]}),(0,u.jsxs)("div",{style:{display:"grid",gap:12},children:[g?(0,u.jsx)("div",{style:{fontSize:"1rem",fontWeight:600,marginBottom:12},children:g}):null,(0,u.jsx)("div",{style:{opacity:.75,fontStyle:"italic"},children:r.length?(0,n.__)("Previewing your selected games (max 2).","top-games"):(0,n.sprintf)((0,n.__)("Previewing %d latest game(s) with offset %d.","top-games"),h,f)}),O.length?(0,u.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:O.map(e=>{const t=((e,t="standard")=>{const r=e?._embedded?.["wp:featuredmedia"]?.[0];if(!r)return"";const a=r?.media_details?.sizes||{};return"featured"===t?a?.large?.source_url||a?.full?.source_url||a?.medium_large?.source_url||a?.medium?.source_url||r?.source_url||"":a?.medium_large?.source_url||a?.medium?.source_url||r?.source_url||a?.thumbnail?.source_url||""})(e,m),r=(e=>{const t=e?._embedded?.["wp:term"];if(!Array.isArray(t))return null;for(const e of t)if(Array.isArray(e)){const t=e.find(e=>"genre"===e?.taxonomy);if(t)return t}return null})(e),a=e?.title?.rendered||`#${e.id}`,l=z(a),n=e?.excerpt?.rendered?z(e.excerpt.rendered):"";return(0,u.jsxs)("li",{style:{display:"flex",flexDirection:"column",gap:8,padding:"12px 0",borderBottom:"1px solid #eee"},children:[d&&t?(0,u.jsx)("img",{src:t,alt:l,onError:e=>{e.currentTarget.style.display="none"},style:{width:"100%",height:"auto",...(s=m,"featured"===s?{maxHeight:420,aspectRatio:"16/9",objectFit:"cover",borderRadius:6}:{maxHeight:220,aspectRatio:"16/9",objectFit:"cover",borderRadius:6})}}):null,r?(0,u.jsx)("div",{style:{fontSize:"0.75rem",fontWeight:700,opacity:.8},children:r.name}):null,(0,u.jsx)("h3",{style:{margin:0,fontSize:D(m,p),lineHeight:1.15},dangerouslySetInnerHTML:{__html:a}}),"featured"===m&&n?(0,u.jsx)("p",{style:{margin:0,fontSize:"0.98rem",lineHeight:1.5,opacity:.9},children:n}):null]},e.id);var s})}):(0,u.jsx)("div",{style:{opacity:.7},children:(0,n.__)("No games found for preview.","top-games")})]})]})},save:()=>null})}},r={};function a(e){var l=r[e];if(void 0!==l)return l.exports;var n=r[e]={exports:{}};return t[e](n,n.exports,a),n.exports}a.m=t,e=[],a.O=(t,r,l,n)=>{if(!r){var s=1/0;for(c=0;c<e.length;c++){for(var[r,l,n]=e[c],i=!0,o=0;o<r.length;o++)(!1&n||s>=n)&&Object.keys(a.O).every(e=>a.O[e](r[o]))?r.splice(o--,1):(i=!1,n<s&&(s=n));if(i){e.splice(c--,1);var d=l();void 0!==d&&(t=d)}}return t}n=n||0;for(var c=e.length;c>0&&e[c-1][2]>n;c--)e[c]=e[c-1];e[c]=[r,l,n]},a.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return a.d(t,{a:t}),t},a.d=(e,t)=>{for(var r in t)a.o(t,r)&&!a.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={259:0,339:0};a.O.j=t=>0===e[t];var t=(t,r)=>{var l,n,[s,i,o]=r,d=0;if(s.some(t=>0!==e[t])){for(l in i)a.o(i,l)&&(a.m[l]=i[l]);if(o)var c=o(a)}for(t&&t(r);d<s.length;d++)n=s[d],a.o(e,n)&&e[n]&&e[n][0](),e[n]=0;return a.O(c)},r=globalThis.webpackChunktop_games=globalThis.webpackChunktop_games||[];r.forEach(t.bind(null,0)),r.push=t.bind(null,r.push.bind(r))})();var l=a.O(void 0,[339],()=>a(62));l=a.O(l)})();