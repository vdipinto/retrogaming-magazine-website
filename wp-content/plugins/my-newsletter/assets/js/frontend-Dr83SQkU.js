console.log("MyNewsletter bundle loaded");document.addEventListener("submit",async a=>{const s=a.target;if(!s.matches("form.ns-form"))return;a.preventDefault();const e=s.querySelector(".ns-message"),t=s.querySelector(".ns-submit"),c=window.NSNewsletter&&NSNewsletter.restUrl||"/wp-json/mynews/v1/signup",m=window.NSNewsletter&&NSNewsletter.ok||"Thanks! Check your inbox.",d=window.NSNewsletter&&NSNewsletter.err||"Something went wrong.",o={first_name:s.first_name?.value?.trim()||"",last_name:s.last_name?.value?.trim()||"",email:s.email?.value?.trim()||""};if(!o.email||!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o.email)){e&&(e.textContent="Please enter a valid email.",e.classList.remove("success"),e.classList.add("error"));return}const i=t?t.textContent:null;t&&(t.disabled=!0,t.textContent=(i||"Subscribe")+"â€¦"),e&&(e.textContent="",e.classList.remove("success","error"));try{const n=await fetch(c,{method:"POST",headers:{"Content-Type":"application/json"},credentials:"same-origin",body:JSON.stringify(o)});let r=null;try{r=await n.json()}catch{}if(n.ok&&r&&(r.success===!0||r.success==="true"))e&&(e.classList.add("success"),e.textContent=r.message||m),s.reset();else{const l=r?.message||d;e&&(e.classList.add("error"),e.textContent=l)}}catch(n){e&&(e.classList.add("error"),e.textContent="Network error."),console.error("MyNewsletter submit error:",n)}finally{t&&(t.disabled=!1,t.textContent=i||"Subscribe")}});
